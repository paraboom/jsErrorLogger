/*! jsErrorLogger (v0.1.0),
 Advanced javascript error logger ,
 by Ivan Shornikov <paraboom@gmail.com>
 Tue Oct 14 2014 */
(function(){var r;r={},null==window.modula&&(window.modula={"export":function(t,e){return r[t]=e},require:function(t){var e;if(e=r[t])return e;throw"Module '"+t+"' not found."}})}).call(this),function(){var __slice=[].slice;window.JsErrorLogger=function(){function _Class(r){r.errorProcessFn&&_.isFunction(r.errorProcessFn)&&(this.errorProcessFn=r.errorProcessFn),window.onerror=_.bind(this.onError,this)}var LOG_LEVELS,LOG_LEVEL_ALIASES,VISITED_PAGES_LENGTH;return LOG_LEVELS="info warn error".split(" "),LOG_LEVEL_ALIASES={log:"info"},VISITED_PAGES_LENGTH=5,_Class.prototype.addLogger=function(r){var t,e,n,o;for(n=0,o=LOG_LEVELS.length;o>n;n++)e=LOG_LEVELS[n],r[e]=function(r){return echo[e](r)};for(t in LOG_LEVEL_ALIASES)e=LOG_LEVEL_ALIASES[t],r[t]=r[e];return r},_Class.prototype.onError=function(r,t,e,n,o){var s,a,i;return this.rethrow?this.rethrow=!1:(i=0===e,a=_.isObject(r),s=null!=o,i||(s?this._catch(o):a?this._catch({message:"Unknown error",data:r}):this._catch({message:"Global error: "+r+" @ "+t+":"+e+":"+n}))),!1},_Class.prototype.processError=function(r){return this.errorProcessFn(r)},_Class.prototype.catchWrap=function(r,t){var e,n,o,s;return t?(n=r,o=n[t],n[t]=this.catchWrap(o)):(e=r,s=this,function(){var r,t;r=1<=arguments.length?__slice.call(arguments,0):[];try{return e.apply(this,r)}catch(n){return t=n,s._catch(t)}})},_Class.prototype.catchWrapTimer=function(obj,fnName){var originFn,that;return originFn=obj[fnName],that=this,obj[fnName]=function(){var args,fn,wrappedFn;return fn=arguments[0],args=2<=arguments.length?__slice.call(arguments,1):[],wrappedFn=function(){var e;try{return"string"==typeof fn?eval(fn):fn.apply(this,arguments)}catch(_error){return e=_error,that._catch(e)}},originFn.call.apply(originFn,[window,wrappedFn].concat(__slice.call(args)))}},_Class.prototype.logPageVisit=function(r){var t;if(window.localStorage)return r||(r=this._getDefaultStore()),t=r.get("visited_pages")||[],t.length>0&&this._logRecentlyVisitedPages(t),t.push({location:window.location.href,time:new Date}),t.length>VISITED_PAGES_LENGTH&&(t=t.slice(t.length-VISITED_PAGES_LENGTH)),r.set("visited_pages",t)},_Class.prototype._catch=function(r){return this.processError(r)},_Class.prototype._logRecentlyVisitedPages=function(r){var t,e,n,o;for(this.log("Recently visited pages:"),o=[],e=0,n=r.length;n>e;e++)t=r[e],o.push(this.log(""+t.time+": "+t.location));return o},_Class.prototype._getDefaultStore=function(){return{get:function(r){var t,e;e=window.localStorage.getItem(r);try{return JSON.parse(e)}catch(n){return t=n,e||void 0}},set:function(r,t){return null!=t&&window.localStorage.setItem(r,JSON.stringify(t)),t}}},_Class}(),modula["export"]("js_error_logger",JsErrorLogger)}.call(this);