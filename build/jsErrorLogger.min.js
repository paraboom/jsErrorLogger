/*! jsErrorLogger (v0.1.10),
 Advanced javascript error logger ,
 by Ivan Shornikov <paraboom@gmail.com>
 Mon Feb 09 2015 */
(function(){var t;t={},null==window.modula&&(window.modula={"export":function(r,e){return t[r]=e},require:function(r){var e;if(e=t[r])return e;throw"Module '"+r+"' not found."}})}).call(this),function(){var __slice=[].slice;window.JsErrorLogger=function(){function _Class(t){t.errorProcessFn&&_.isFunction(t.errorProcessFn)&&(this.errorProcessFn=t.errorProcessFn),t.store&&(this.store=t.store),window.onerror=_.bind(this.onError,this)}var LOG_LEVELS,LOG_LEVEL_ALIASES,VISITED_PAGES_LENGTH;return LOG_LEVELS="info warn error".split(" "),LOG_LEVEL_ALIASES={log:"info"},VISITED_PAGES_LENGTH=5,_Class.prototype.addLogger=function(t){var r,e,o,n;for(o=0,n=LOG_LEVELS.length;n>o;o++)e=LOG_LEVELS[o],t[e]=function(t){return function(r){return echo[t](r)}}(e);for(r in LOG_LEVEL_ALIASES)e=LOG_LEVEL_ALIASES[r],t[r]=t[e];return t},_Class.prototype.onError=function(t,r,e,o,n){var s,a,i;return this.rethrow?this.rethrow=!1:(i=0===e,a=_.isObject(t),s=null!=n,i||(s?this._catch(n):a?this._catch({message:"Unknown error",data:t}):this._catch({message:"Global error: "+t+" @ "+r+":"+e+":"+o}))),!1},_Class.prototype.processError=function(t){return"function"==typeof this.errorProcessFn?this.errorProcessFn(t,this._errorData(t)):void 0},_Class.prototype.catchWrap=function(t,r){var e,o,n,s;return r?(o=t,n=o[r],o[r]=this.catchWrap(n)):(e=t,s=this,function(){var t,r;t=1<=arguments.length?__slice.call(arguments,0):[];try{return e.apply(this,t)}catch(o){throw r=o}})},_Class.prototype.catchWrapTimer=function(obj,fnName){var originFn,that;return originFn=obj[fnName],that=this,obj[fnName]=function(){var args,fn,wrappedFn;return fn=arguments[0],args=2<=arguments.length?__slice.call(arguments,1):[],wrappedFn=function(){var e;try{return"string"==typeof fn?eval(fn):fn.apply(this,arguments)}catch(_error){throw e=_error}},originFn.call.apply(originFn,[window,wrappedFn].concat(__slice.call(args)))}},_Class.prototype.logPageVisit=function(){var t,r;return this._checkStorage(this.store)?(t=this.store?this.store:this._getDefaultStore(),r=t.get("visited_pages")||[],r.length>0&&this._logRecentlyVisitedPages(r),r.push({location:window.location.href,time:new Date}),r.length>VISITED_PAGES_LENGTH&&(r=r.slice(r.length-VISITED_PAGES_LENGTH)),t.set("visited_pages",r)):!1},_Class.prototype._logsDump=function(){return echo.dump()},_Class.prototype._stacktrace=function(t){return printStackTrace({e:t})},_Class.prototype._stacktraceDump=function(t){return JSON.stringify(this._stacktrace(t))},_Class.prototype._userAgent=function(){return navigator.userAgent},_Class.prototype._errorData=function(t){return{name:t.name,level:"error",msg:t.message,data:t.data,stacktrace:this._stacktraceDump(t),logs:this._logsDump()}},_Class.prototype._catch=function(t){return this.processError(t)},_Class.prototype._logRecentlyVisitedPages=function(t){var r,e,o,n;for(echo.info("Recently visited pages:"),n=[],e=0,o=t.length;o>e;e++)r=t[e],n.push(echo.info(""+r.time+": "+r.location));return n},_Class.prototype._checkStorage=function(t){var r;if(t&&t.enabled)return!0;try{return localStorage.setItem("test","test"),localStorage.removeItem("test"),!0}catch(e){return r=e,!1}},_Class.prototype._getDefaultStore=function(){return{get:function(t){var r,e;e=window.localStorage.getItem(t);try{return JSON.parse(e)}catch(o){return r=o,e||void 0}},set:function(t,r){return null!=r&&window.localStorage.setItem(t,JSON.stringify(r)),r}}},_Class}(),modula["export"]("js_error_logger",JsErrorLogger)}.call(this);