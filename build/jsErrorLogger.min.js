/*! jsErrorLogger (v0.1.0),
 Advanced javascript error logger ,
 by Ivan Shornikov <paraboom@gmail.com>
 Thu Oct 23 2014 */
(function(){var t;t={},null==window.modula&&(window.modula={"export":function(r,e){return t[r]=e},require:function(r){var e;if(e=t[r])return e;throw"Module '"+r+"' not found."}})}).call(this),function(){var __slice=[].slice;window.JsErrorLogger=function(){function _Class(t){t.errorProcessFn&&_.isFunction(t.errorProcessFn)&&(this.errorProcessFn=t.errorProcessFn),t.store&&(this.store=t.store),t.dataFunction&&(this.dataFunction=t.dataFunction),window.onerror=_.bind(this.onError,this)}var LOG_LEVELS,LOG_LEVEL_ALIASES,VISITED_PAGES_LENGTH;return LOG_LEVELS="info warn error".split(" "),LOG_LEVEL_ALIASES={log:"info"},VISITED_PAGES_LENGTH=5,_Class.prototype.addLogger=function(t){var r,e,n,o;for(n=0,o=LOG_LEVELS.length;o>n;n++)e=LOG_LEVELS[n],t[e]=function(t){return echo[e](t)};for(r in LOG_LEVEL_ALIASES)e=LOG_LEVEL_ALIASES[r],t[r]=t[e];return t},_Class.prototype.onError=function(t,r,e,n,o){var s,a,i;return this.rethrow?this.rethrow=!1:(i=0===e,a=_.isObject(t),s=null!=o,i||(s?this._catch(o):a?this._catch({message:"Unknown error",data:t}):this._catch({message:"Global error: "+t+" @ "+r+":"+e+":"+n}))),!1},_Class.prototype.processError=function(t){return"function"==typeof this.errorProcessFn?this.errorProcessFn(t,this._errorData(t)):void 0},_Class.prototype.catchWrap=function(t,r){var e,n,o,s;return r?(n=t,o=n[r],n[r]=this.catchWrap(o)):(e=t,s=this,function(){var t,r;t=1<=arguments.length?__slice.call(arguments,0):[];try{return e.apply(this,t)}catch(n){return r=n,s._catch(r)}})},_Class.prototype.catchWrapTimer=function(obj,fnName){var originFn,that;return originFn=obj[fnName],that=this,obj[fnName]=function(){var args,fn,wrappedFn;return fn=arguments[0],args=2<=arguments.length?__slice.call(arguments,1):[],wrappedFn=function(){var e;try{return"string"==typeof fn?eval(fn):fn.apply(this,arguments)}catch(_error){return e=_error,that._catch(e)}},originFn.call.apply(originFn,[window,wrappedFn].concat(__slice.call(args)))}},_Class.prototype.logPageVisit=function(){var t,r;if(window.localStorage)return t=this.store?this.store:this._getDefaultStore(),r=t.get("visited_pages")||[],r.length>0&&this._logRecentlyVisitedPages(r),r.push({location:window.location.href,time:new Date}),r.length>VISITED_PAGES_LENGTH&&(r=r.slice(r.length-VISITED_PAGES_LENGTH)),t.set("visited_pages",r)},_Class.prototype._logsDump=function(){return echo.dump()},_Class.prototype._stacktrace=function(t){return printStackTrace({e:t})},_Class.prototype._stacktraceDump=function(t){return JSON.stringify(this._stacktrace(t))},_Class.prototype._userAgent=function(){return navigator.userAgent},_Class.prototype._errorData=function(t){return{name:t.name,level:"error",msg:t.message,person:("function"==typeof this.dataFunction?this.dataFunction("user"):void 0)||"",data:t.data,stacktrace:this._stacktraceDump(t),logs:this._logsDump()}},_Class.prototype._catch=function(t){return this.processError(t)},_Class.prototype._logRecentlyVisitedPages=function(t){var r,e,n,o;for(this.log("Recently visited pages:"),o=[],e=0,n=t.length;n>e;e++)r=t[e],o.push(this.log(""+r.time+": "+r.location));return o},_Class.prototype._getDefaultStore=function(){return{get:function(t){var r,e;e=window.localStorage.getItem(t);try{return JSON.parse(e)}catch(n){return r=n,e||void 0}},set:function(t,r){return null!=r&&window.localStorage.setItem(t,JSON.stringify(r)),r}}},_Class}(),modula["export"]("js_error_logger",JsErrorLogger)}.call(this);